#!/usr/bin/env bash 

# This script is for cherry-picking between branches when files have moved

SHA=$1
ORIGFILE=$2
TARGETFILE=$2

if [[ $# -eq 3 ]]; then
    TARGETFILE=$3
fi

if [ ! -f "$TARGETFILE" ]; then
    echo "Could not find $TARGETFILE"

    TARGETFILE=$(find . -iname `basename $TARGETFILE`)

    echo "Use $TARGETFILE instead?"

    read -n 1 CONTINUE

    if [ "$CONTINUE" == "n" ] || [ "$CONTINUE" == "N" ]; then 
        echo 
        echo Cancelling integration...
        echo
        exit 1
    fi
fi

echo About to patch from:
echo      sha:  $SHA
echo      src:  $ORIGFILE
echo   target:  $TARGETFILE
echo 

git diff $SHA~1..$SHA -- $ORIGFILE | patch $TARGETFILE

if [ $? -eq 0 ]; then
    git add $TARGETFILE

    echo "************************************"
    echo "       SUCCESSFULLY MERGED          "
    echo "************************************"
else
    echo "************************************"
    echo "ERROR:  Conflicts, fix them first..."
    echo "************************************"
fi


